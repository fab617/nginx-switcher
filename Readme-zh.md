# nginx-switcher

一个简单易用的nginx配置文件管理工具，支持多配置文件管理、服务启停和状态监控。

## 功能特点

- 📁 **配置文件管理**：扫描、添加、删除、编辑nginx配置文件
- 🚀 **服务管理**：启动、停止nginx服务
- 📊 **状态监控**：实时监控nginx服务状态
- 📋 **端口管理**：自动识别配置文件中的端口信息
- 🖥️ **系统托盘**：支持最小化到系统托盘，显示运行状态
- 🔄 **自动刷新**：定期扫描nginx进程，更新服务状态
- 🔧 **配置验证**：验证nginx配置文件的有效性

## 安装和使用

### 环境要求

- Windows操作系统
- .NET Framework 4.7.2 或更高版本
- nginx 1.20.0 或更高版本

### 安装

1. 下载最新版本的`nginx-switcher.exe`
2. 直接运行，无需安装
3. 首次运行时，程序会要求指定系统中的nginx.exe文件

### 基本使用

1. **配置nginx路径**：
   - 首次运行时，程序会自动扫描nginx.exe
   - 也可以通过点击"配置nginx"按钮手动选择nginx.exe路径

2. **管理配置文件**：
   - 点击"扫描配置文件"，程序会自动扫描nginx配置目录下的.conf文件
   - 点击"添加配置文件"，手动添加自定义配置文件
   - 点击"删除配置文件"，删除选中的配置文件
   - 点击"编辑"，使用记事本打开配置文件进行编辑

3. **管理nginx服务**：
   - 选中配置文件，点击"启动"启动nginx服务
   - 选中配置文件，点击"停止"停止nginx服务
   - 点击"刷新配置文件"，重新扫描配置文件

## 主要功能说明

### 配置文件扫描

程序会自动扫描nginx配置目录下的所有.conf文件，并检查是否包含http配置块。只有包含http配置块的文件才会被识别为主配置文件。

### 服务状态监控

- 程序会每5秒扫描一次系统中的nginx进程
- 自动更新配置文件的状态（运行中/已停止）
- 系统托盘图标会显示当前运行的nginx进程数量

### 多配置文件管理

- 支持同时管理多个nginx配置文件
- 每个配置文件对应独立的工作目录
- 支持为每个配置文件设置不同的端口

### 系统托盘功能

- 最小化时自动隐藏到系统托盘
- 双击托盘图标显示主窗口
- 右键菜单支持快速操作

## 项目结构

```
nginx-switcher/
├── App.config              # 应用程序配置
├── ConfigManager.cs        # 配置文件管理类
├── Context.cs              # 应用程序上下文
├── Form1.cs                # 主窗口代码
├── Form1.Designer.cs       # 主窗口设计器代码
├── GetImageSize.cs         # 图像处理辅助类
├── NginxConfigFile.cs      # Nginx配置文件类
├── NginxProcessMonitor.cs  # Nginx进程监控类
├── Program.cs              # 程序入口
└── Properties/             # 项目属性
```

## 技术栈

- **开发语言**：C#
- **框架**：.NET Framework 4.7.2
- **UI框架**：Windows Forms
- **开发工具**：Visual Studio 2026，TRAE

## 注意事项

1. **权限要求**：
   - 运行nginx服务可能需要管理员权限
   - 建议以管理员身份运行程序

2. **配置文件格式**：
   - 确保配置文件包含有效的http配置块
   - 每个配置文件建议使用不同的端口

3. **工作目录**：
   - 每个配置文件会生成独立的工作目录
   - 工作目录位于程序目录下的`nginx_work`文件夹

4. **日志文件**：
   - nginx日志文件位于对应工作目录的`logs`文件夹
   - 程序运行日志输出到控制台

## 常见问题

### Q: 为什么扫描不到配置文件？
A: 请确保nginx路径配置正确，且配置文件目录下存在包含http配置块的.conf文件。

### Q: 为什么启动nginx服务失败？
A: 请检查：
   - nginx路径是否正确
   - 配置文件是否有效
   - 端口是否被占用
   - 是否以管理员身份运行程序

### Q: 为什么系统托盘图标不显示？
A: 请检查系统托盘设置，确保允许显示程序图标。

## 许可证

MIT License

## 贡献

欢迎提交Issue和Pull Request！

## 更新日志

### v0.1.0
- 初始版本
- 支持配置文件管理
- 支持nginx服务启停
- 支持系统托盘监控
